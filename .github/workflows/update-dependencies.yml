name: Update Dependencies

on:
    schedule:
        # Run weekly on Monday at 09:00 UTC
        -   cron: "0 9 * * 1"
    workflow_dispatch: # Allow manual trigger

permissions:
    contents: write
    pull-requests: write

jobs:
    update-dependencies:
        name: Update npm dependencies
        runs-on: ubuntu-latest
        steps:
            -   name: Checkout code
                uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0

            -   name: Setup Node.js
                uses: actions/setup-node@2028fbc5c25fe9cf00d9f06a71cc4710d4507903 # v6.0.0
                with:
                    node-version: "22"

            -   name: Update dependencies
                run: |
                    # Update all dependencies to latest compatible versions
                    npm update --save
                    npm update --save-dev

            -   name: Run tests to verify updates
                run: |
                    npm install
                    npm run typecheck
                    npm run lint
                    npm run test:run

            -   name: Create Pull Request
                uses: peter-evans/create-pull-request@84ae59a2cdc2258d6fa0732dd66352dddae2a412 # v7.0.9
                with:
                    commit-message: "chore(deps): update npm dependencies"
                    branch: deps/npm-updates
                    delete-branch: true
                    title: "chore(deps): update npm dependencies"
                    body: |
                        ## Automated Dependency Updates

                        This PR updates npm dependencies to their latest compatible versions.

                        ### Changes
                        - Updated dependencies based on semver ranges in package.json

                        ### Testing
                        - ✅ Type checking passed
                        - ✅ Linting passed
                        - ✅ Tests passed

                        **Note:** This PR was automatically generated by a GitHub Actions workflow.
                    labels: |
                        dependencies
                        automated
                    assignees: ${{ github.repository_owner }}
                    draft: false
