name: Update Dependencies

on:
    schedule:
        # Run weekly on Monday at 09:00 UTC
        -   cron: "0 9 * * 1"
    workflow_dispatch: # Allow manual trigger

permissions:
    contents: write
    pull-requests: write

jobs:
    update-dependencies:
        name: Update npm dependencies
        runs-on: ubuntu-latest
        steps:
            -   name: Checkout code
                uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2

            -   name: Setup Node.js
                uses: actions/setup-node@6044e13b5dc448c55e2357c09f80417699197238 # v6.2.0
                with:
                    node-version: "24"

            -   name: Update dependencies
                run: |
                    # Update all dependencies to latest compatible versions
                    npm update --save
                    npm update --save-dev

            -   name: Run tests to verify updates
                run: |
                    npm install --ignore-scripts
                    npm run typecheck
                    npm run lint
                    npm run test:run

            -   name: Create Pull Request
                uses: peter-evans/create-pull-request@c0f553fe549906ede9cf27b5156039d195d2ece0 # v8.1.0
                with:
                    commit-message: "chore(deps): update npm dependencies"
                    branch: deps/npm-updates
                    delete-branch: true
                    title: "chore(deps): update npm dependencies"
                    body: |
                        ## Automated Dependency Updates

                        This PR updates npm dependencies to their latest compatible versions.

                        ### Changes
                        - Updated dependencies based on semver ranges in package.json

                        ### Testing
                        - ✅ Type checking passed
                        - ✅ Linting passed
                        - ✅ Tests passed

                        **Note:** This PR was automatically generated by a GitHub Actions workflow.
                    labels: |
                        dependencies
                        automated
                    assignees: ${{ github.repository_owner }}
                    draft: false
