name: AI PR Review

on:
    pull_request:
        types: [opened, reopened, ready_for_review, synchronize]
    issue_comment:
        types: [created]

permissions:
    contents: read
    issues: write
    pull-requests: write

jobs:
    pr-agent-review:
        name: AI PR Review
        # Skip if triggered by a bot to avoid loops
        if: ${{ github.event.sender.type != 'Bot' }}
        runs-on: ubuntu-latest
        steps:
            -   name: Run PR Agent
                uses: qodo-ai/pr-agent@d36ad319f7fb0049205017405a71275c41599587 # v0.31
                env:
                    # OpenAI API key (required) - add as repository secret
                    # Settings > Secrets and variables > Actions > New repository secret
                    OPENAI_KEY: ${{ secrets.OPENAI_KEY }}
                    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
                    # Configuration options
                    github_action_config.auto_review: "true"
                    github_action_config.auto_describe: "true"
                    github_action_config.auto_improve: "false"
