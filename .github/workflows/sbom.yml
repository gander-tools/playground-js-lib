name: SBOM Generation

on:
    push:
        branches:
            - master
    pull_request:
    release:
        types:
            - published

permissions:
    contents: read

jobs:
    sbom:
        name: Generate SBOM
        runs-on: ubuntu-latest
        permissions:
            contents: write

        steps:
            -   name: Harden Runner
                uses: step-security/harden-runner@91182cccc01eb5e619899d80e4e971d6181294a7 # v2.10.1
                with:
                    disable-sudo: true
                    egress-policy: audit

            -   name: Checkout code
                uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0

            -   name: Generate SBOM
                uses: anchore/sbom-action@df4c1d428146066b0b1bb5c558c0e61a8285e2e0 # v0.18.1
                with:
                    format: 'spdx-json'
                    output-file: 'sbom.spdx.json'

            -   name: Upload SBOM artifact
                uses: actions/upload-artifact@e44cfb7d5be6f0eef7d1304bfe0bc51f099fb0bf # v4.6.0
                with:
                    name: sbom
                    path: sbom.spdx.json
                    retention-days: 90
