name: Semgrep Security Analysis

on:
    push:
        branches:
            - master
    pull_request:
    schedule:
        # Run weekly on Wednesdays at 00:00 UTC
        -   cron: '0 0 * * 3'

permissions:
    contents: read

jobs:
    semgrep:
        name: Semgrep Scan
        runs-on: ubuntu-latest
        permissions:
            contents: read
            security-events: write

        steps:
            -   name: Harden Runner
                uses: step-security/harden-runner@91182cccc01eb5e619899d80e4e971d6181294a7 # v2.10.1
                with:
                    disable-sudo: true
                    egress-policy: audit

            -   name: Checkout code
                uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0

            -   name: Run Semgrep
                uses: returntocorp/semgrep-action@98aaa00bd90e79ae9afa23b5c1e6d7313e0481fb # v1.102.0
                with:
                    config: >-
                        p/security-audit
                        p/typescript
                        p/javascript
                    generateSarif: true

            -   name: Upload SARIF results
                uses: github/codeql-action/upload-sarif@df409f7d9260372bd5f19e5b04e83cb3c43714ae # v3.27.9
                if: always()
                with:
                    sarif_file: semgrep.sarif
